{% extends "base.html" %}

{% block content %}
<div class="audio-studio">
    <!-- í—¤ë” -->
    <header class="studio-header">
        <div class="studio-title">
            <h1>ğŸµ ìŒì•… ìŠ¤íŠœë””ì˜¤</h1>
            <p>íŒŒì¼ ì—…ë¡œë“œë¶€í„° í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„±, ìŒì› ì¶”ì¶œ, ì˜ìƒ ì œì‘ê¹Œì§€ í•œ ë²ˆì—</p>
        </div>
    </header>

    <!-- íŒŒì¼ ê´€ë¦¬ ì„¹ì…˜ (ê³µí†µ) -->
    <section class="file-manager" id="fileManager">
        <div class="upload-zone">
            <!-- íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ -->
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“</div>
                <h2>íŒŒì¼ ì—…ë¡œë“œ</h2>
                <p>ìŒì› íŒŒì¼ (MP3, WAV, M4A, FLAC)ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                
                <input type="file" id="fileInput" multiple accept=".mp3,.wav,.m4a,.flac,.mp4,.webm" hidden>
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                    ğŸ“ íŒŒì¼ ì„ íƒ
                </button>
            </div>
            
            <!-- URL ì…ë ¥ ì˜ì—­ -->
            <div class="url-input-section">
                <div class="section-divider">
                    <span>ë˜ëŠ”</span>
                </div>
                <div class="url-section">
                    <h3>YouTube ë§í¬ ì¶”ì¶œ</h3>
                    <p>YouTube URLì„ ì…ë ¥í•˜ì—¬ ìŒì›ì„ ì¶”ì¶œí•˜ì„¸ìš”</p>
                    <div class="url-input-group">
                        <input type="url" id="urlInput" placeholder="https://youtube.com/watch?v=..." class="url-input">
                        <button class="btn btn-secondary" onclick="extractFromUrl()">ğŸ”— ë§í¬ ì¶”ì¶œ</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ì—…ë¡œë“œëœ íŒŒì¼ ëª©ë¡ -->
        <div class="files-list" id="filesList" style="display: none;">
            <h3>ğŸ“‚ ì—…ë¡œë“œëœ íŒŒì¼</h3>
            <div class="files-container" id="filesContainer"></div>
        </div>
    </section>

    <!-- ì‘ì—… ì„ íƒ ì„¹ì…˜ -->
    <section class="work-selector" id="workSelector" style="display: none;">
        <h3>ğŸ› ï¸ ì‘ì—… ì„ íƒ</h3>
        <div class="work-options">
            <div class="work-option" onclick="selectWork('playlist')">
                <div class="work-icon">ğŸµ</div>
                <h4>í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„±</h4>
                <p>ì—¬ëŸ¬ ìŒì›ì„ í•˜ë‚˜ë¡œ í•©ì¹˜ê¸°</p>
            </div>
            <div class="work-option" onclick="selectWork('extract')">
                <div class="work-icon">ğŸ§</div>
                <h4>ìŒì› ì¶”ì¶œ & í¸ì§‘</h4>
                <p>ìŒì› ì¶”ì¶œ, í‚¤ ë³€ê²½, ìë¥´ê¸°</p>
            </div>
            <div class="work-option" onclick="selectWork('video')">
                <div class="work-icon">ğŸ¬</div>
                <h4>ìŒì› ì˜ìƒ ë§Œë“¤ê¸°</h4>
                <p>ìŒì› + ì´ë¯¸ì§€ë¡œ ë™ì˜ìƒ ìƒì„±</p>
            </div>
        </div>
    </section>

    <!-- ì‘ì—…ë³„ ì„¤ì • ì„¹ì…˜ -->
    <section class="work-settings" id="workSettings" style="display: none;">
        <!-- í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„± ì„¤ì • -->
        <div class="settings-panel" id="playlistSettings">
            <h3>ğŸµ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„± ì„¤ì •</h3>
            <div class="settings-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="normalizeVolume" checked>
                    <span>ë³¼ë¥¨ ì •ê·œí™”</span>
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="crossfade">
                    <span>í¬ë¡œìŠ¤í˜ì´ë“œ</span>
                </label>
            </div>
        </div>

        <!-- ìŒì› ì¶”ì¶œ ì„¤ì • -->
        <div class="settings-panel" id="extractSettings">
            <h3>ğŸ§ ìŒì› ì¶”ì¶œ & í¸ì§‘ ì„¤ì •</h3>
            <div class="settings-group">
                <div class="setting-item">
                    <label>ì¶œë ¥ í˜•ì‹:</label>
                    <select id="outputFormat" class="form-select">
                        <option value="mp3">MP3 (ê¶Œì¥)</option>
                        <option value="wav">WAV (ê³ ìŒì§ˆ)</option>
                        <option value="original">ì›ë³¸ í˜•ì‹</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label>í‚¤ ì¡°ì ˆ (ë°˜ìŒ): <span id="pitchValue">0</span></label>
                    <input type="range" id="pitchSlider" min="-12" max="12" value="0" step="1" 
                           oninput="document.getElementById('pitchValue').textContent = this.value">
                </div>
                <div class="setting-item">
                    <label class="checkbox-label">
                        <input type="checkbox" id="trimToThirty">
                        <span>30ì´ˆë¡œ ìë¥´ê¸°</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- ë™ì˜ìƒ ìƒì„± ì„¤ì • -->
        <div class="settings-panel" id="videoSettings">
            <h3>ğŸ¬ ë™ì˜ìƒ ìƒì„± ì„¤ì •</h3>
            <div class="settings-group">
                <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
                <div class="image-upload-section">
                    <label>ë°°ê²½ ì´ë¯¸ì§€:</label>
                    <div class="image-upload-area" id="imageUploadArea">
                        <div class="upload-placeholder">
                            <span class="upload-icon">ğŸ–¼ï¸</span>
                            <p>ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</p>
                            <p class="file-types">JPG, PNG, BMP, GIF</p>
                        </div>
                        <input type="file" id="imageInput" accept=".jpg,.jpeg,.png,.bmp,.gif" hidden>
                        <button class="btn btn-outline" onclick="document.getElementById('imageInput').click()">
                            ì´ë¯¸ì§€ ì„ íƒ
                        </button>
                    </div>
                    
                    <!-- ë¡œê³  í•©ì„± ì»¨íŠ¸ë¡¤ (ì´ë¯¸ì§€ ì—…ë¡œë“œ ë°”ë¡œ ì•„ë˜) -->
                    <div class="logo-section" id="logoSection" style="margin-top: 20px;">
                        <label>ë¡œê³  í•©ì„±:</label>
                        <div class="logo-controls">
                            <input type="file" id="logoInput" accept=".png,.jpg,.jpeg" hidden>
                            <button class="btn btn-outline" id="logoSelectBtn" onclick="selectLogoFile()">
                                ğŸ·ï¸ ë¡œê³  ì„ íƒ
                            </button>
                            <button class="btn btn-success" id="logoApplyBtn" onclick="applyLogoComposite()" style="display: none;">
                                âœ¨ ë¡œê³  í•©ì„± ì ìš©
                            </button>
                            <button class="btn btn-secondary" id="logoRemoveBtn" onclick="removeLogoComposite()" style="display: none;">
                                ğŸ—‘ï¸ ë¡œê³  ì œê±°
                            </button>
                        </div>
                        <div class="logo-help-text" id="logoHelpText">
                            <p style="color: #666; font-size: 14px; margin: 10px 0 0 0;">
                                ğŸ’¡ ë¨¼ì € ë°°ê²½ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•œ í›„ ë¡œê³ ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </p>
                        </div>
                        <div class="logo-preview-area" id="logoPreviewArea" style="display: none;">
                            <!-- ë¡œê³  ë¯¸ë¦¬ë³´ê¸°ê°€ ì—¬ê¸°ì— í‘œì‹œë¨ -->
                        </div>
                    </div>
                </div>
                
                <div class="setting-item">
                    <label>ë™ì˜ìƒ í’ˆì§ˆ:</label>
                    <select id="videoQuality" class="form-select">
                        <option value="youtube_hd">ìœ íŠœë¸Œ HD (1080p)</option>
                        <option value="youtube_standard">ìœ íŠœë¸Œ í‘œì¤€ (720p)</option>
                        <option value="youtube_mobile">ëª¨ë°”ì¼ ìµœì í™”</option>
                    </select>
                </div>
                
                <div class="setting-item">
                    <label class="checkbox-label">
                        <input type="checkbox" id="addWatermark">
                        <span>ë¡œê³  ì›Œí„°ë§ˆí¬ ì¶”ê°€</span>
                    </label>
                </div>
                
            </div>
        </div>
        
        <!-- ì‹¤í–‰ ë²„íŠ¼ -->
        <div class="execute-section">
            <button class="btn btn-success btn-large" id="executeBtn" onclick="executeWork()">
                <span id="executeText">ğŸµ ì‹¤í–‰í•˜ê¸°</span>
            </button>
        </div>
    </section>

    <!-- ì§„í–‰ ìƒí™© (ê³µí†µ) -->
    <section class="progress-section" id="progressSection" style="display: none;">
        <h3 id="progressTitle">ì²˜ë¦¬ ì¤‘...</h3>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <p class="progress-text" id="progressText">ì¤€ë¹„ ì¤‘...</p>
    </section>

    <!-- ê²°ê³¼ (ê³µí†µ) -->
    <section class="result-section" id="resultSection" style="display: none;">
        <h3>âœ… ì™„ë£Œ!</h3>
        <div class="result-content" id="resultContent">
            <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
        </div>
        <div class="result-actions">
            <button class="btn btn-primary" id="downloadBtn">ğŸ“¥ ë‹¤ìš´ë¡œë“œ</button>
            <button class="btn btn-secondary" onclick="resetStudio()">ğŸ”„ ìƒˆë¡œ ì‹œì‘</button>
        </div>
    </section>

</div>
{% endblock %}

{% block extra_css %}
<style>
.audio-studio {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.studio-header {
    text-align: center;
    margin-bottom: 40px;
    padding: 30px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    color: white;
}

.studio-title h1 {
    margin: 0 0 10px 0;
    font-size: 2.5rem;
}

.studio-title p {
    margin: 0;
    font-size: 1.1rem;
    opacity: 0.9;
}

.file-manager {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.upload-area {
    border: 3px dashed #ddd;
    border-radius: 12px;
    padding: 40px;
    text-align: center;
    transition: all 0.3s ease;
    background: #fafafa;
}

.upload-area:hover, .upload-area.drag-over {
    border-color: #667eea;
    background: #f0f4ff;
}

.upload-icon {
    font-size: 3rem;
    margin-bottom: 15px;
    display: block;
}

.upload-area h2 {
    margin: 0 0 10px 0;
    color: #333;
}

.upload-area p {
    margin: 0 0 20px 0;
    color: #666;
}

.url-input-section {
    margin-top: 30px;
}

.url-section {
    background: #f8f9fa;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    padding: 30px;
    text-align: center;
}

.url-section h3 {
    margin: 0 0 10px 0;
    color: #333;
    font-size: 1.3rem;
}

.url-section p {
    margin: 0 0 20px 0;
    color: #666;
}

.section-divider {
    text-align: center;
    margin: 20px 0;
    position: relative;
}

.section-divider::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: #ddd;
}

.section-divider span {
    background: white;
    padding: 0 15px;
    color: #999;
    font-size: 14px;
}

.url-input-group {
    display: flex;
    gap: 10px;
}

.url-input {
    flex: 1;
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 16px;
}

.url-input:focus {
    border-color: #667eea;
    outline: none;
}

.files-list {
    margin-top: 30px;
    padding-top: 30px;
    border-top: 1px solid #eee;
}

.files-container {
    margin-top: 15px;
}

.file-item {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    border: 1px solid #eee;
}

.file-header {
    display: flex;
    align-items: center;
    gap: 15px;
}

.file-icon {
    font-size: 1.5rem;
}

.file-info {
    flex: 1;
}

.file-name {
    font-weight: 500;
    color: #333;
}

.file-details {
    font-size: 14px;
    color: #666;
    margin-top: 5px;
}

.work-selector {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.work-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.work-option {
    background: #f8f9fa;
    border: 2px solid #eee;
    border-radius: 12px;
    padding: 25px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.work-option:hover {
    border-color: #667eea;
    background: #f0f4ff;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
}

.work-icon {
    font-size: 2.5rem;
    margin-bottom: 15px;
}

.work-option h4 {
    margin: 0 0 10px 0;
    color: #333;
}

.work-option p {
    margin: 0;
    color: #666;
    font-size: 14px;
}

.work-settings {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.settings-panel {
    display: none;
}

.settings-group {
    margin-top: 20px;
}

.setting-item {
    margin-bottom: 20px;
}

.setting-item label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #333;
}

.form-select {
    width: 100%;
    padding: 10px;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 16px;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    margin-bottom: 10px;
    font-weight: normal;
}

.image-upload-area {
    border: 2px dashed #ddd;
    border-radius: 8px;
    padding: 30px;
    text-align: center;
    background: #fafafa;
    margin-bottom: 15px;
}

.upload-placeholder .upload-icon {
    font-size: 2rem;
    margin-bottom: 10px;
    display: block;
}

.file-types {
    font-size: 12px;
    color: #999;
    margin-top: 5px;
}

.image-preview {
    text-align: center;
    margin-top: 15px;
}

#imageUploadArea .image-preview img,
.image-upload-area .image-preview img,
.image-preview img {
    max-width: 66% !important; /* 3ë¶„ì˜ 2 í¬ê¸°ë¡œ í™•ëŒ€ */
    max-height: 300px !important; /* ë†’ì´ë„ ì¦ê°€ */
    width: auto !important;
    height: auto !important;
    border-radius: 8px !important;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
    margin-bottom: 15px !important;
}

.image-name {
    margin: 10px 0;
    font-size: 14px;
    color: #333;
    font-weight: 500;
}

.btn-small {
    padding: 8px 16px;
    font-size: 14px;
}

.image-upload-area.drag-over {
    border-color: #667eea;
    background: #f0f4ff;
}

.logo-upload-section {
    margin-top: 15px;
    padding: 15px;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    background: #f8f9fa;
}

.logo-upload-area {
    border: 2px dashed #ccc;
    border-radius: 6px;
    padding: 20px;
    text-align: center;
    background: white;
    margin-bottom: 10px;
}

.logo-upload-area .upload-icon {
    font-size: 1.5rem;
    margin-bottom: 8px;
    display: block;
}

.logo-composite-area {
    border: 2px dashed #ddd;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    background: #f8f9fa;
    margin-bottom: 15px;
}

.logo-composite-area .upload-icon {
    font-size: 1.5rem;
    margin-bottom: 8px;
    display: block;
}

.logo-composite-area.has-logo {
    border-color: #28a745;
    background: #f8fff9;
}

.logo-section {
    padding: 15px;
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    margin-top: 20px;
}

.logo-section label {
    display: block;
    margin-bottom: 10px;
    font-weight: 500;
    color: #333;
}

.logo-controls {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 15px;
}

.logo-controls .btn {
    padding: 8px 12px;
    font-size: 14px;
    border-radius: 6px;
}

.logo-preview-area {
    margin-top: 15px;
    padding: 15px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    background: #f8f9fa;
    text-align: center;
}

.logo-preview-area.has-logo {
    border-color: #28a745;
    background: #f8fff9;
}

.logo-preview-area img {
    max-width: 150px;
    max-height: 100px;
    border-radius: 6px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.15);
}

.logo-preview {
    text-align: center;
}

.logo-name {
    margin: 10px 0 5px 0;
    font-size: 14px;
    color: #333;
    font-weight: 500;
}

.logo-status {
    font-size: 12px;
    color: #666;
    margin-bottom: 10px;
}

.execute-section {
    margin-top: 30px;
    padding-top: 30px;
    border-top: 2px solid #eee;
    text-align: center;
}

.progress-section {
    background: white;
    border-radius: 12px;
    padding: 40px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    margin-bottom: 30px;
    text-align: center;
}

.progress-bar {
    width: 100%;
    height: 20px;
    background: #f0f0f0;
    border-radius: 10px;
    overflow: hidden;
    margin: 20px 0;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    width: 0%;
    transition: width 0.3s ease;
}

.result-section {
    background: white;
    border-radius: 12px;
    padding: 40px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    text-align: center;
}

.result-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 30px;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
}

.btn-primary {
    background: #667eea;
    color: white;
}

.btn-primary:hover {
    background: #5a6fd8;
    transform: translateY(-1px);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
    transform: translateY(-1px);
}

.btn-success {
    background: #28a745;
    color: white;
}

.btn-success:hover {
    background: #218838;
    transform: translateY(-1px);
}

.btn-outline {
    background: transparent;
    color: #667eea;
    border: 2px solid #667eea;
}

.btn-outline:hover {
    background: #667eea;
    color: white;
}

.btn-large {
    padding: 15px 40px;
    font-size: 18px;
}

.btn-icon {
    background: transparent;
    border: none;
    font-size: 18px;
    cursor: pointer;
    padding: 5px;
    border-radius: 4px;
}

.btn-icon:hover {
    background: #f0f0f0;
}

.btn-danger {
    color: #dc3545;
}

.btn-danger:hover {
    background: #dc3545;
    color: white;
}

.btn:disabled {
    background: #e9ecef;
    color: #6c757d;
    border-color: #dee2e6;
    cursor: not-allowed;
    opacity: 0.6;
}

.btn:disabled:hover {
    background: #e9ecef;
    color: #6c757d;
    transform: none;
}

@media (max-width: 768px) {
    .audio-studio {
        padding: 10px;
    }
    
    .studio-title h1 {
        font-size: 2rem;
    }
    
    .work-options {
        grid-template-columns: 1fr;
    }
    
    .url-input-group {
        flex-direction: column;
    }
    
    .result-actions {
        flex-direction: column;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/audio_studio.js') }}"></script>
{% endblock %}